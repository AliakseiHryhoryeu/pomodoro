(()=>{let t,m,o="",c=[];const s=()=>new Promise(t=>{chrome.storage.sync.get([o],e=>{t(e[o]?JSON.parse(e[o]):[])})}),r=async()=>{var e=m.currentTime,e={time:e,desc:"Bookmark at "+getTime(e)};c=await s(),chrome.storage.sync.set({[o]:JSON.stringify([...c,e].sort((e,t)=>e.time-t.time))})},i=async()=>{var e=document.getElementsByClassName("bookmark-btn")[0];c=await s(),e||((e=document.createElement("img")).src=chrome.runtime.getURL("assets/bookmark.png"),e.className="ytp-button bookmark-btn",e.title="Click to bookmark current timestamp",t=document.getElementsByClassName("ytp-left-controls")[0],m=document.getElementsByClassName("video-stream")[0],t.appendChild(e),e.addEventListener("click",r))};chrome.runtime.onMessage.addListener((e,t,s)=>{const{type:r,value:n,videoId:a}=e;"NEW"===r?(o=a,i()):"PLAY"===r?m.currentTime=n:"DELETE"===r&&(c=c.filter(e=>e.time!=n),chrome.storage.sync.set({[o]:JSON.stringify(c)}),s(c))}),i()})();const getTime=e=>{var t=new Date(0);return t.setSeconds(e),t.toISOString().substr(11,8)};